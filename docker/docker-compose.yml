version: '3'
services:
  first:
    image: btcd:latest
    security_opt: 
      - apparmor=unconfined
    cap_add:
      - SYS_PTRACE
    command: [
      "./btcd",
      "--testnet",
      "--addrindex",
      # "--generate",
      "--nodnsseed",
      "--miningaddr=dagtest:qrgufg4qzfqacfzrf6xvx46aqedr5nke3qv6a74fex",
      "--rpcuser=user",
      "--rpcpass=pass",
      "--rpclisten=0.0.0.0:18334",
      "--rpccert=/go/src/github.com/daglabs/btcd/docker/rpc.cert",
      "--rpckey=/go/src/github.com/daglabs/btcd/docker/rpc.key"
    ]
    ports: ["18334:18334"]

  second:
    image: btcd:latest
    links: ["first"]
    security_opt: 
      - apparmor=unconfined
    cap_add:
      - SYS_PTRACE
    command: [
      "./btcd",
      "--testnet",
      "--addrindex",
      "--connect=first",
      "--rpcuser=user",
      "--rpcpass=pass",
      "--miningaddr=dagtest:qrgufg4qzfqacfzrf6xvx46aqedr5nke3qv6a74fex",
      "--rpclisten=0.0.0.0:18334",
      "--rpccert=/go/src/github.com/daglabs/btcd/docker/rpc.cert",
      "--rpckey=/go/src/github.com/daglabs/btcd/docker/rpc.key"
    ]
    ports: ["18335:18334"]

  second-debug:
    image: btcd:latest
    links: ["first"]
    security_opt: 
      - apparmor=unconfined
    cap_add:
      - SYS_PTRACE
    command: [
      "dlv", 
      "--listen=:40000", 
      "--api-version=2", 
      "--headless=true",
      "exec",
      "./btcd",
      "--",
      # here starts btcd parameters
      "--testnet",
      "--addrindex",
      "--connect=first",
      "--rpcuser=user",
      "--rpcpass=pass",
      "--miningaddr=dagtest:qrgufg4qzfqacfzrf6xvx46aqedr5nke3qv6a74fex",
      "--rpclisten=0.0.0.0:18334",
      "--rpccert=/go/src/github.com/daglabs/btcd/docker/rpc.cert",
      "--rpckey=/go/src/github.com/daglabs/btcd/docker/rpc.key"
    ]
    ports: ["18335:18334", "40000:40000"]
